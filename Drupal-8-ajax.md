Ajax (Asynchronous Javascript and XML — «асинхронный JavaScript и XML») - это процесс динамического обновления частей HTML-страницы на основе данных с сервера. Со стороны клиента (веб-браузера) выполняется запрос на сервер с помощью XMLHttpRequest, сервер в свою очередь выполняет необходимые действия и возвращает ответ в виде заголовков и данных в формате JSON или XML (так же можно передвать другие типы данных, к примеру HTML или текст, но указанные 2 формата наиболее популярны), далее скрипт, который инициализировал запрос распоряжается полученными данными по предварительно заданному алгоритму.

Но наша цель не изучение самой технологии AJAX, а его практическое применение в CMS Drupal 8 (далее Drupal). В связи с этим рекомендуется перед началом изучения статьи, ознакомиться c AJAX подходом.

В "ядре" Drupal реализован инструментарий для работы с наиболее часто встречающимися AJAX командами а так же предусмотрена возможность создания своих комманд, для решения конкретной задачи.
Общий алгоритм взаимодействия следующий:

1. Создается гиперссылка с классом "use-ajax"
2. По клику на ссылку с указанным классом, скрипт (core/misc/ajax.js) выполняет асинхронный запрос на сервер, по указанному в аттрибуте HREF гиперссылки пути.
3. На стороне сервера, по пути, на которую ссылается гиперссылка, вызывается контролер, который выполняет все необходимые действия, генерирует список команд и возвращает формате JSON.
4. Скрипт получает набор команд и поочередно выполняет их.

А теперь подробнее разберем выше описанный процесс.


### Часть 1. Создание гиперссылок.

Гиперссылки вы можете создать любым удобным способом (добавив ссылки из текстового редактора, описав в файле шаблона TWIG или создав программный блок с текстом...). Важны 2 фактора: наличи аттрибута href, где указан URL, который должен обработать AJAX запрос и класс use-ajax, который является "индикатором" того, что ссылка должна быть обработана с помощью XMLHttpRequest. Но есть один ньюанс, для корректной обработки AJAX ссылок, необходимо, чтобы на странице, где выводится данная ссылка, была подключена библиотека core/drupal.ajax (core/misc/ajax.js). Для решения этой задачи есть несколько способов.

1. Если ссылка выводится с помощью программного кода, то можно в "render массиве" указать следующее:

```
$output['#attached']['library'][] = 'core/drupal.ajax';
```

2. Если ссылка выводится в TWIG шаблоне, то можно использовать следующую конструкцию
```
{{ attach_library('core/drupal.ajax') }}
```


3. Есть более универсиальный вариант, подключить библиотеку в хуке hook_page_alter (файл mymodule.module):
```
function mymodule_page_alter(&$page) {
  if(***ATTACH CONDITIONS***){
    $page['#attached']['library'][] = 'foobar/foobar-corescripts';
  }
}
```
Где \*\*\*ATTACH CONDITIONS\*\*\* - условия, по которой определяете когда необходимо подключать AJAX библиотеку.


Или любым другим известным вам вариантом подключения библиотеки к странице.

